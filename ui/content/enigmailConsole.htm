<html>
<head>
  <title>Enigmail Console</title>

  <script language="JavaScript" src="chrome://enigmail/content/enigmailCommon.js">
  </script>

  <script language="JavaScript">

    //netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");

    window.mouseDownState = false;

    function RefreshConsole() {
      var enigmailSvc = GetEnigmailSvc();
      if (!enigmailSvc)
        return;

      if (enigmailSvc.console.hasNewData) {
         //DEBUG_LOG("enigmailConsole.htm: RefreshConsole()\n");

         enigmailSvc.console.hasNewData = true;
         var console = document.getElementById('console');
         console.firstChild.data = enigmailSvc.console.data;

         if (!window.mouseDownState)
            window.scrollTo(0,9999);
      }
      return false;
    }

    function LoadHandler() {
      var enigmailSvc = GetEnigmailSvc();
      if (!enigmailSvc)
        return;

      WRITE_LOG("enigmailConsole.htm: LoadHandler: "+enigmailSvc+"\n");

      // Refresh console every 2 seconds
      RefreshConsole();
      window.consoleIntervalId = window.setInterval(RefreshConsole, 2000);
    }

    function UnloadHandler() {
       // Cancel console refresh
       if (window.consoleIntervalId)
          window.clearInterval(window.consoleIntervalId);
    }

    function MouseDown(val) {
      // Tracks mouse down state
      window.mouseDownState = val;
      return true;
    }

  </script>

</head>

<body onLoad="LoadHandler();"
      onMouseDown="MouseDown(true);"
      onMouseUp="MouseDown(false);"
      onUnload="UnloadHandler();">

  <pre id="console">
   CONSOLE
  </pre>

</body>

</html>
